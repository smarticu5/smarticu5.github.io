<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Spinny Remote Controls | Adventures in Containerland</title>
<meta name="keywords" content="homeassistant, automation">
<meta name="description" content="A home automation post about remote controls that spin me right round, baby, right round.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/2023-08-18-spinny-remote-controls/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2023-08-18-spinny-remote-controls/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Adventures in Containerland (Alt + H)">Adventures in Containerland</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/talks/" title="Talks">
                    <span>Talks</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Spinny Remote Controls
    </h1>
    <div class="post-meta"><span title='2023-08-18 00:00:00 +0000 UTC'>August 18, 2023</span>

</div>
  </header> 
  <div class="post-content"><p>This is hopefully the first of multiple posts details home automations I&rsquo;ve written for <a href="">home-assistant.io</a> which are interesting enough to talk about. The posts are probably going to be a reminder for me about what I wrote and how, rather than a tutorial.</p>
<h2 id="hardware">Hardware<a hidden class="anchor" aria-hidden="true" href="#hardware">#</a></h2>
<p>I&rsquo;ve got a few Sonos speakers scattered throughout the house. These mostly just do their thing without needing any changes, but sometimes I want to quickly play/pause/change volume without needing to get my phone. I picked up a couple of IKEA rotary Symfonisk remotes, which have since been sadly discontinued and I can&rsquo;t even find a link to them on the IKEA website. If anyone&rsquo;s interested, they have <a href="https://www.zigbee2mqtt.io/devices/E1744.html">this entry on Zigbee2MQTT&rsquo;s Wiki</a>.</p>
<p>The devices expose a few actions, and a &ldquo;brightness&rdquo; setting. If you&rsquo;re using them with the official IKEA hub there&rsquo;s no need to even set up anything tricky, the marketing suggests that everything just works in-app. That doesn&rsquo;t work for me, because who would use vendor hubs when you can spend too long half-assing a custom solution.</p>
<h2 id="software">Software<a hidden class="anchor" aria-hidden="true" href="#software">#</a></h2>
<p>Adding the spinny remote to Home Assistant was dead easy. So was making the play-pause functionality work:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">device</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">domain</span>: <span style="color:#ae81ff">mqtt</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">device_id</span>: <span style="color:#ae81ff">abcd1234</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">action</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subtype</span>: <span style="color:#ae81ff">play_pause</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">choose</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">or</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">device</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">domain</span>: <span style="color:#ae81ff">media_player</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">media_player.sonos_office</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">type</span>: <span style="color:#ae81ff">is_paused</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">device</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">domain</span>: <span style="color:#ae81ff">media_player</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">media_player.sonos_office</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">type</span>: <span style="color:#ae81ff">is_playing</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">sequence</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">media_player.media_play_pause</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">data</span>: {}
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">media_player.sonos_office</span>
</span></span></code></pre></div><p>The automation above basically says &ldquo;If the Sonos in the office is playing or paused, toggle the play/pause state&rdquo;. I&rsquo;ve added another condition to say if the state is stopped, pick a random playlist and start that, using the play_media calls.</p>
<p>What was a bit trickier was getting the volume control right. I would adjust the volume on my phone, then mess with the remote and have the volume suddenly jump. This was because the remote has no idea of what the volume actually is, only what its own &ldquo;brightness&rdquo; field is set to.</p>
<p>The workaround for this was to check if the remote was being rotated left or right. If it&rsquo;s left, the volume is going down, so set the volume to the lower of the remote&rsquo;s setting or the speaker&rsquo;s current volume. If it&rsquo;s right, the opposite. This means you might need to turn the remote a bit more, but you never end up spinning the remote to turn the volume down and have it suddenly launch way higher.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">service</span>: <span style="color:#ae81ff">media_player.volume_set</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volume_level</span>: &gt;<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {% raw %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {% set office_remote_volume =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    float(state_attr(&#39;sensor.spinny_remote_action&#39;, &#39;brightness&#39;)/255) |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    round(2)%}  {%- if trigger.id == &#34;volume_up&#34; -%}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {{float(max(office_remote_volume,state_attr(&#34;media_player.sonos_office&#34;,&#34;volume_level&#34;)))}}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {%- elif trigger.id == &#34;volume_down&#34; -%}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {{float(min(office_remote_volume,state_attr(&#34;media_player.sonos_office&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;volume_level&#34;)))}}  {%- endif -%}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {% endraw %}</span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">media_player.sonos_office</span>
</span></span></code></pre></div><p>Incidentally, posting this blog also taught me that Jekyll tries to render Home Assistant templates, and that makes GitHub Actions fail. Sad times.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/homeassistant/">Homeassistant</a></li>
      <li><a href="http://localhost:1313/tags/automation/">Automation</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">Adventures in Containerland</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
